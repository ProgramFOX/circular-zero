<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>Circular[0] - prototype</title>

    <link rel="stylesheet" type="text/css" href="main.css" />

    <script type="text/javascript" src="jquery-2.1.0.js"></script>

    <script type="text/javascript" src="webgl-utils.js"></script>
    <script type="text/javascript" src="Circle.js"></script>
    <script type="text/javascript" src="Line.js"></script>
    <script type="text/javascript" src="circular-zero.js"></script>

    <!--[if IE]>
        <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <script id="circle-vertex-shader" type="x-shader/x-vertex">
        #define PI 3.1415926535897932384626433832795

        uniform float uRenderScale;

        uniform vec2 uCenter;
        uniform float uR;
        uniform float uFromAngle;
        uniform float uToAngle;

        attribute vec4 aPos;
        attribute vec4 aColor;

        varying vec4 vColor;

        void main()
        {
            vColor = aColor;
            // Map the angle of the given vertex from (-pi,pi] to [uFromAngle,uToAngle)
            // (-pi, pi] -> (-0.5, 0.5]
            float t = atan(aPos.y, aPos.x) / (2.0*PI);
            // map the (-0.5, 0.0) range to (0.5, 1)
            t = mod(t, 1.0);
            // map [0.0, 1.0) to [uFromAngle, uToAngle)
            float mappedAngle = t * (uToAngle - uFromAngle) + uFromAngle;

            // We also need the initial distance from the origin to account for origin-vertices
            // and faraway vertices for circle insides and outsides
            float r = aPos.x*aPos.x + aPos.y*aPos.y;

            // The render scale shrinks or grows the viewport and refers to which percentage
            // of the screen will be filled by the [-1, 1] coordinate range.
            gl_Position = vec4(uRenderScale * (uR * r * cos(mappedAngle) + uCenter.x),
                               uRenderScale * (uR * r * sin(mappedAngle) + uCenter.y),
                               uRenderScale * aPos.z,
                               aPos.w);
        }
    </script>

    <script id="circle-fragment-shader" type="x-shader/x-fragment">
        #ifdef GL_ES
        precision mediump float;
        #endif

        varying vec4 vColor;

        void main() {
            gl_FragColor = vColor;
        }
    </script>

    <script id="line-vertex-shader" type="x-shader/x-vertex">
        uniform float uAngle;

        attribute vec4 aPos;
        attribute vec4 aColor;

        varying vec4 vColor;

        void main()
        {
            vColor = aColor;
            // No need for scaling, because all lines go through the center
            gl_Position = vec4( cos(uAngle)*aPos.x - sin(uAngle)*aPos.y,
                                sin(uAngle)*aPos.x + cos(uAngle)*aPos.y,
                                0.0,
                                1.0) ;
        }
    </script>

    <script id="line-fragment-shader" type="x-shader/x-fragment">
        #ifdef GL_ES
        precision mediump float;
        #endif

        varying vec4 vColor;

        void main() {
            gl_FragColor = vColor;
        }
    </script>

</head>
<body>
    <canvas id="gl-canvas">
        Oops ... your browser doesn't support HTML5's Canvas elements!
    </canvas>
    <div id="message"></div>
    <div id="debug">
        Normalised cursor coordinates:<br>
        x = <span id="xcoord"></span><br>
        y = <span id="ycoord"></span><br>
        <br>
        Last mouse down:<br>
        x = <span id="xdown"></span><br>
        y = <span id="ydown"></span><br>
        <br>
        Last mouse up:<br>
        x = <span id="xup"></span><br>
        y = <span id="yup"></span>
    </div>
</body>
</html>
